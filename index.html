<!DOCTYPE html>
<html>
  <head>
    <!--script src="js/build/react-with-addons.js"></script>
    <script src="js/build/JSXTransformer.js"></script-->
    <script src="js/snap.svg-min.js"></script>
    <script src="taiwan_railways.js"></script>

    <style>
    </style>
  </head>
  <body>
    <div id="svg"></div>
    <script>
    function parseArray(railwaysList) {
      return railwaysList.map(function(railway) {
        return railway.map(function(r) {
          return [r[0], r[1], r[2], r[3], {x: (r[4][0] + r[4][2]) / 2, y: (r[4][1] + r[4][3]) / 2}]
        })
      });
    }
    window.onload = function () {
      var r = [];
      var s = Snap(600, 600);
      var k = 0;
      var dot = [];
      railways = parseArray(railways);
      var drawIt = function() {
        if (k >= railways.length) {
          return;
        }
        var railway = railways[k];

        for (var j = 1; j < railway.length; j++) {
          var r_exist = false
          var ele = railway[j - 1];
          var coords = ele[4];
          var x = coords.x;
          var y = coords.y;
          var prev = railway[j];
          var px = prev[4].x;
          var py = prev[4].y;
          r_exist = !!r[j - 1];

          if (!r_exist) {
            r[j - 1] = s.line(x, y, x, y);
            r[j - 1].attr({
              strokeWidth: 2,
              stroke: "#000",
              "stroke-opacity": 0.5
            });
            r[j - 1].animate({
              x2: px,
              y2: py
            }, 200);
          }
          else {
            r[j - 1].animate({
              x1: x,
              y1: y,
              x2: px,
              y2: py,
              stroke: "#00ff00"
            }, 200)
          }
        }
        for (var jj = j - 1; jj < r.length; jj++) {
          r[jj].animate({
            opacity: 0.1
          }, 200, null, function() {
            this.remove();
          }.bind(r[jj]));
        }

        for (var i = 0; i < railway.length; i++) {
          var dot_exist = false
          var ele = railway[i];
          var coords = ele[4];
          var x = coords.x;
          var y = coords.y;
          dot_exist = !!dot[i];
          if (!dot_exist) {
            dot[i] = s.circle(x, y, 1);
            dot[i].animate({r: 5}, (200 * Math.min(railway.length - i, dot.length - i)), function() {
              this.attr({ fill: "#ff0000", stroke: "#000", strokeWidth: 2, "stroke-opacity": 0.5 });
            });
          }
          else {
            dot[i].animate({
              cx: x,
              cy: y
            }, 220);
          }
        }
        for (var ii = i; ii < dot.length; ii++) {
          dot[ii].animate({
            opacity: 0.1,
            r: 1
          }, 220, null, function() {
            this.remove();
          }.bind(dot[ii]));
        }

        k++;
      };
      window.addEventListener("keyup", drawIt, false);
      // drawIt();
    };
    </script>
  </body>
</html>
